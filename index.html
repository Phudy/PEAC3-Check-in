<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PEAC3 Check-in</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700;800;900&family=Prompt:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        kanit: ['Kanit', 'sans-serif'],
                        prompt: ['Prompt', 'sans-serif'],
                        sans: ['Prompt', 'sans-serif'],
                    },
                    colors: {
                        pea: {
                            purple: '#7A2F8D',
                            dark: '#4A148C',
                            neon: '#B042FF',
                            gold: '#FDB913',
                            light: '#F3E5F5',
                            bg: '#F8FAFC' 
                        }
                    },
                    animation: {
                        'spin-slow': 'spin 12s linear infinite',
                        'float': 'float 8s ease-in-out infinite',
                        'float-delayed': 'float 8s ease-in-out 4s infinite',
                        'pulse-glow': 'pulse-glow 3s infinite',
                        'wave': 'wave 2s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translate(0, 0) rotate(0deg)' },
                            '33%': { transform: 'translate(10px, -20px) rotate(5deg)' },
                            '66%': { transform: 'translate(-10px, 20px) rotate(-5deg)' },
                        },
                        'pulse-glow': {
                            '0%, 100%': { opacity: 1, filter: 'brightness(1)' },
                            '50%': { opacity: 0.8, filter: 'brightness(1.2)' },
                        },
                        wave: {
                            '0%': { backgroundPosition: '100% 0' },
                            '100%': { backgroundPosition: '-100% 0' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Force Full Screen & No Scroll Globally */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Prompt', sans-serif;
            background-color: #F8FAFC; 
            color: #1e293b; 
        }

        #root {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Modern Scrollbar */
        .modern-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .modern-scrollbar::-webkit-scrollbar-track {
            background: #F1F5F9;
        }
        .modern-scrollbar::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 3px;
        }
        .modern-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #7A2F8D;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn { animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
        
        /* Custom Selection Color */
        ::selection {
            background: #FDB913;
            color: #000;
        }

        /* Input styling adjustments for Light Mode */
        input[type="time"]::-webkit-calendar-picker-indicator,
        input[type="date"]::-webkit-calendar-picker-indicator {
            cursor: pointer;
            opacity: 0.6;
        }
        
        /* Cursor styles for panning */
        .cursor-grab { cursor: grab; }
        .cursor-grabbing { cursor: grabbing; }
    </style>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-pea-bg text-slate-800">
    <!-- Loading Indicator -->
    <div id="root">
        <div class="h-full w-full flex items-center justify-center text-slate-400 gap-2">
            <svg class="animate-spin h-5 w-5 text-pea-purple" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span class="font-kanit">กำลังโหลดระบบ...</span>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useRef, useEffect, useMemo, useLayoutEffect } = React;

        // --- Icon Components ---
        const Icon = ({ children, size = 24, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Check = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12" /></Icon>;
        const Plus = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></Icon>;
        const Trash2 = (props) => <Icon {...props}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></Icon>;
        const Maximize = (props) => <Icon {...props}><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" /></Icon>;
        const Settings = (props) => <Icon {...props}><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" /><circle cx="12" cy="12" r="3" /></Icon>;
        const Upload = (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" y1="3" x2="12" y2="15" /></Icon>;
        const MapPin = (props) => <Icon {...props}><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" /><circle cx="12" cy="10" r="3" /></Icon>;
        const Calendar = (props) => <Icon {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></Icon>;
        const Clock = (props) => <Icon {...props}><circle cx="12" cy="12" r="10" /><polyline points="12 6 12 12 16 14" /></Icon>;
        const Users = (props) => <Icon {...props}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M23 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></Icon>;
        const QrCode = (props) => <Icon {...props}><rect x="3" y="3" width="7" height="7" /><rect x="14" y="3" width="7" height="7" /><rect x="14" y="14" width="7" height="7" /><rect x="3" y="14" width="7" height="7" /></Icon>;
        const FolderOpen = (props) => <Icon {...props}><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" /></Icon>;
        const Database = (props) => <Icon {...props}><ellipse cx="12" cy="5" rx="9" ry="3" /><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3" /><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" /></Icon>;
        const ChevronRight = (props) => <Icon {...props}><polyline points="9 18 15 12 9 6" /></Icon>;
        const LayoutTemplate = (props) => <Icon {...props}><rect x="3" y="3" width="18" height="18" rx="2" ry="2" /><line x1="3" y1="9" x2="21" y2="9" /><line x1="9" y1="21" x2="9" y2="9" /></Icon>;
        const X = (props) => <Icon {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></Icon>;
        const Edit3 = (props) => <Icon {...props}><path d="M12 20h9" /><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" /></Icon>;
        const List = (props) => <Icon {...props}><line x1="8" y1="6" x2="21" y2="6" /><line x1="8" y1="12" x2="21" y2="12" /><line x1="8" y1="18" x2="21" y2="18" /><line x1="3" y1="6" x2="3.01" y2="6" /><line x1="3" y1="12" x2="3.01" y2="12" /><line x1="3" y1="18" x2="3.01" y2="18" /></Icon>;
        const ArrowUp = (props) => <Icon {...props}><line x1="12" y1="19" x2="12" y2="5" /><polyline points="5 12 12 5 19 12" /></Icon>;
        const ArrowDown = (props) => <Icon {...props}><line x1="12" y1="5" x2="12" y2="19" /><polyline points="19 12 12 19 5 12" /></Icon>;
        const Minus = (props) => <Icon {...props}><line x1="5" y1="12" x2="19" y2="12" /></Icon>;
        const ZoomIn = (props) => <Icon {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /><line x1="11" y1="8" x2="11" y2="14" /><line x1="8" y1="11" x2="14" y2="11" /></Icon>;
        const ZoomOut = (props) => <Icon {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /><line x1="8" y1="11" x2="14" y2="11" /></Icon>;
        const RotateCcw = (props) => <Icon {...props}><polyline points="1 4 1 10 7 10" /><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></Icon>;
        const RefreshCw = (props) => <Icon {...props}><polyline points="23 4 23 10 17 10" /><polyline points="1 20 1 14 7 14" /><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" /></Icon>;

        // --- ฐานข้อมูลหลัก (Master Data) ---
        const MASTER_DATA = [
            {
                id: 'g1',
                name: 'กฟจ.นครปฐม',
                children: [
                { id: 'c1-1', name: 'กฟส.นครปฐม', checked: false },
                { id: 'c1-2', name: 'กฟส.ดอนตูม', checked: false },
                { id: 'c1-3', name: 'กฟส.สามพราน', checked: false },
                { id: 'c1-4', name: 'กฟส.กำแพงแสน', checked: false },
                { id: 'c1-5', name: 'กฟส.นครชัยศรี', checked: false },
                { id: 'c1-6', name: 'กฟส.บางเลน', checked: false },
                { id: 'c1-7', name: 'กฟส.พุทธมณฑล', checked: false },
                ]
            },
            {
                id: 'g2',
                name: 'กฟจ.สุพรรณบุรี',
                children: [
                { id: 'c2-1', name: 'กฟส.สุพรรณบุรี', checked: false },
                { id: 'c2-2', name: 'กฟส.บางปลาม้า', checked: false },
                { id: 'c2-3', name: 'กฟส.ดอนเจดีย์', checked: false },
                { id: 'c2-4', name: 'กฟส.ศรีประจันต์', checked: false },
                { id: 'c2-5', name: 'กฟส.สามชุก', checked: false },
                { id: 'c2-6', name: 'กฟส.อู่ทอง', checked: false },
                { id: 'c2-7', name: 'กฟส.สองพี่น้อง', checked: false },
                { id: 'c2-8', name: 'กฟส.เดิมบางนางบวช', checked: false },
                { id: 'c2-9', name: 'กฟส.ด่านช้าง', checked: false },
                { id: 'c2-10', name: 'กฟส.หนองหญ้าไซ', checked: false },
                ]
            },
            {
                id: 'g3',
                name: 'กฟจ.กาญจนบุรี',
                children: [
                { id: 'c3-1', name: 'กฟส.กาญจนบุรี', checked: false },
                { id: 'c3-2', name: 'กฟส.ท่าม่วง', checked: false },
                { id: 'c3-3', name: 'กฟส.พนมทวน', checked: false },
                { id: 'c3-4', name: 'กฟส.ไทรโยค', checked: false },
                { id: 'c3-5', name: 'กฟส.ทองผาภูมิ', checked: false },
                { id: 'c3-6', name: 'กฟส.ด่านมะขามเตี้ย', checked: false },
                { id: 'c3-7', name: 'กฟส.ลาดหญ้า', checked: false },
                { id: 'c3-8', name: 'กฟส.บ่อพลอย', checked: false },
                { id: 'c3-9', name: 'กฟส.เลาขวัญ', checked: false },
                { id: 'c3-10', name: 'กฟส.ท่ามะกา', checked: false },
                { id: 'c3-11', name: 'กฟส.ท่าเรือ', checked: false },
                ]
            },
            {
                id: 'g4',
                name: 'กฟจ.สมุทรสาคร',
                children: [
                { id: 'c4-1', name: 'กฟส.สมุทรสาคร', checked: false },
                { id: 'c4-2', name: 'กฟส.สมุทรสาคร 2(บพว)', checked: false },
                { id: 'c4-3', name: 'กฟส.โคกขาม', checked: false },
                { id: 'c4-4', name: 'กฟส.บางน้ำจืด', checked: false },
                { id: 'c4-5', name: 'กฟส.กระทุ่มแบน', checked: false },
                { id: 'c4-6', name: 'กฟส.อ้อมน้อย', checked: false },
                ]
            },
            {
                id: 'g5',
                name: 'หน่วยงานใน กฟก.3',
                children: [
                { id: 'c5-1', name: 'กบล.', checked: false },
                { id: 'c5-2', name: 'กวว.', checked: false },
                { id: 'c5-3', name: 'กรย.', checked: false },
                { id: 'c5-4', name: 'กปบ.', checked: false },
                { id: 'c5-5', name: 'กบษ.', checked: false },
                { id: 'c5-6', name: 'กสฟ.', checked: false },
                { id: 'c5-7', name: 'กบฟ.', checked: false },
                { id: 'c5-8', name: 'กบพ.', checked: false },
                { id: 'c5-9', name: 'กดส.', checked: false },
                { id: 'c5-10', name: 'กสข.', checked: false },
                ]
            }
        ];

        const generateTimeOptions = () => {
            const options = [];
            let hour = 8;
            let minute = 30;
            while (hour < 16 || (hour === 16 && minute <= 30)) {
                const timeString = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                options.push(timeString);
                minute += 30;
                if (minute === 60) {
                    minute = 0;
                    hour++;
                }
            }
            return options;
        };

        const TIME_OPTIONS = generateTimeOptions();

        // --- Auto Scale Text Component ---
        const FitText = ({ text, className, style }) => {
            const containerRef = useRef(null);
            const textRef = useRef(null);
            const [scale, setScale] = useState(1);

            useLayoutEffect(() => {
                const resizeText = () => {
                    if (containerRef.current && textRef.current) {
                        textRef.current.style.transform = 'none';
                        const containerWidth = containerRef.current.offsetWidth;
                        const textWidth = textRef.current.scrollWidth;
                        if (textWidth > containerWidth) {
                            const newScale = containerWidth / textWidth;
                            setScale(newScale);
                        } else {
                            setScale(1);
                        }
                    }
                };
                resizeText();
                window.addEventListener('resize', resizeText);
                return () => window.removeEventListener('resize', resizeText);
            }, [text]);

            return (
                <div ref={containerRef} className="w-full overflow-hidden flex items-center" style={style}>
                    <span 
                        ref={textRef} 
                        className={`${className} whitespace-nowrap origin-left transition-transform duration-200`}
                        style={{ transform: `scale(${scale})`, display: 'inline-block' }}
                    >
                        {text || <span className="opacity-40 italic">หัวข้อการประชุม</span>}
                    </span>
                </div>
            );
        };

        // --- Scalable Container (For Full Screen Overlay Only) ---
        const ScalableContainer = ({ children, isPresenting }) => {
            const containerRef = useRef(null);
            const contentRef = useRef(null);
            const [scale, setScale] = useState(1);

            useLayoutEffect(() => {
                const updateScale = () => {
                    requestAnimationFrame(() => {
                        if (containerRef.current && contentRef.current) {
                            const parent = containerRef.current;
                            const availableWidth = parent.clientWidth;
                            const availableHeight = parent.clientHeight;
                            
                            const contentWidth = 1920; 
                            const contentHeight = contentRef.current.scrollHeight; 
                            const targetHeight = Math.max(1080, contentHeight);

                            const margin = isPresenting ? 0 : 20;
                            
                            const scaleX = (availableWidth - margin) / contentWidth;
                            const scaleY = (availableHeight - margin) / targetHeight;
                            
                            let newScale = Math.min(scaleX, scaleY);
                            
                            if (newScale <= 0 || !isFinite(newScale)) newScale = 1;
                            
                            setScale(newScale);
                        }
                    });
                };

                const observer = new ResizeObserver(updateScale);
                if (contentRef.current) observer.observe(contentRef.current);
                
                window.addEventListener('resize', updateScale);
                updateScale();

                return () => {
                    window.removeEventListener('resize', updateScale);
                    observer.disconnect();
                };
            }, [isPresenting]);

            if (isPresenting) {
                return (
                    <div className="fixed inset-0 z-50 bg-[#F8FAFC] w-screen h-screen flex items-center justify-center overflow-hidden">
                        <div ref={containerRef} className="absolute inset-0 flex items-center justify-center">
                            <div 
                                ref={contentRef}
                                style={{ 
                                    width: '1920px', 
                                    height: 'auto', 
                                    minHeight: '1080px',
                                    transform: `scale(${scale})`, 
                                    transformOrigin: 'center',
                                }}
                                className="bg-white overflow-hidden shadow-2xl flex flex-col"
                            >
                                {children}
                            </div>
                        </div>
                    </div>
                );
            }
            return null;
        };

        // --- Preview Container (Robust Auto Scale with Manual Zoom & Pan) ---
        const PreviewContainer = ({ children }) => {
            const containerRef = useRef(null);
            const contentRef = useRef(null);
            const [autoScale, setAutoScale] = useState(0.1);
            const [manualZoom, setManualZoom] = useState(1);
            
            // Panning State
            const [pan, setPan] = useState({ x: 0, y: 0 });
            const [isDragging, setIsDragging] = useState(false);
            const dragStartRef = useRef({ x: 0, y: 0 });

            useLayoutEffect(() => {
                const handleResize = () => {
                    if (!containerRef.current) return;
                    
                    const parent = containerRef.current;
                    const availableWidth = parent.clientWidth;
                    const availableHeight = parent.clientHeight;
                    
                    if (availableWidth === 0 || availableHeight === 0) return;

                    const baseWidth = 1920;
                    const baseHeight = 1080;
                    
                    const paddingX = 32;
                    const paddingY = 32;
                    
                    const scaleX = (availableWidth - paddingX) / baseWidth; 
                    const scaleY = (availableHeight - paddingY) / baseHeight;
                    
                    let newScale = Math.min(scaleX, scaleY);
                    
                    if (newScale <= 0 || !isFinite(newScale)) newScale = 0.1;
                    
                    setAutoScale(newScale);
                };

                const observer = new ResizeObserver(handleResize);
                if (containerRef.current) {
                    observer.observe(containerRef.current);
                }

                return () => {
                    observer.disconnect();
                };
            }, []);

            const effectiveScale = autoScale * manualZoom;

            const zoomIn = () => setManualZoom(prev => Math.min(prev + 0.1, 3));
            const zoomOut = () => setManualZoom(prev => Math.max(prev - 0.1, 0.5));
            const resetZoom = () => {
                setManualZoom(1);
                setPan({ x: 0, y: 0 }); 
            };

            const handleMouseDown = (e) => {
                e.preventDefault(); 
                setIsDragging(true);
                dragStartRef.current = { 
                    x: e.clientX - pan.x, 
                    y: e.clientY - pan.y 
                };
            };

            const handleMouseMove = (e) => {
                if (!isDragging) return;
                e.preventDefault();
                setPan({
                    x: e.clientX - dragStartRef.current.x,
                    y: e.clientY - dragStartRef.current.y
                });
            };

            const handleMouseUp = () => {
                setIsDragging(false);
            };

            return (
                <div 
                    ref={containerRef} 
                    className={`w-full h-full flex items-center justify-center relative overflow-hidden group/preview ${isDragging ? 'cursor-grabbing' : 'cursor-grab'}`}
                    onMouseDown={handleMouseDown}
                    onMouseMove={handleMouseMove}
                    onMouseUp={handleMouseUp}
                    onMouseLeave={handleMouseUp}
                >
                    <div 
                        className="absolute top-4 right-4 z-50 flex flex-col gap-2 opacity-0 group-hover/preview:opacity-100 transition-opacity duration-300"
                        onMouseDown={(e) => e.stopPropagation()} 
                    >
                        <button onClick={zoomIn} className="bg-white/80 backdrop-blur text-slate-700 p-2 rounded-lg shadow-md hover:bg-white hover:text-pea-purple transition-all active:scale-95" title="ขยาย">
                            <ZoomIn size={20} />
                        </button>
                        <button onClick={resetZoom} className="bg-white/80 backdrop-blur text-slate-700 p-2 rounded-lg shadow-md hover:bg-white hover:text-pea-purple transition-all active:scale-95" title="รีเซ็ตขนาด">
                            <RotateCcw size={20} />
                        </button>
                        <button onClick={zoomOut} className="bg-white/80 backdrop-blur text-slate-700 p-2 rounded-lg shadow-md hover:bg-white hover:text-pea-purple transition-all active:scale-95" title="ย่อ">
                            <ZoomOut size={20} />
                        </button>
                    </div>

                    <div 
                        ref={contentRef}
                        style={{ 
                            width: '1920px', 
                            height: '1080px', 
                            transform: `translate(${pan.x}px, ${pan.y}px) scale(${effectiveScale})`, 
                            transformOrigin: 'center',
                            boxShadow: '0 20px 50px -12px rgba(0, 0, 0, 0.15)',
                            transition: isDragging ? 'none' : 'transform 0.1s ease-out',
                        }}
                        className="bg-white rounded-xl overflow-hidden ring-1 ring-slate-900/5 flex-shrink-0 origin-center select-none"
                    >
                        <div className="w-full h-full pointer-events-none">
                             <div className="w-full h-full pointer-events-auto">
                                {children}
                             </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Full Screen Overlay ---
        const FullScreenOverlay = ({ children }) => {
            return (
                <div className="fixed inset-0 z-[9999] bg-[#F8FAFC] w-screen h-screen overflow-hidden">
                    {children}
                </div>
            );
        };

        // --- Presentation Component ---
        const PresentationView = ({
            meetingInfo,
            groups,
            toggleCheck,
            removeDepartment,
            removeGroup,
            qrCodes,
            toggleFullScreen,
            isPresenting,
            showDocQr
        }) => {
            const totalItems = groups.reduce((acc, group) => acc + group.children.length, 0);
            const checkedItems = groups.reduce((acc, group) => acc + group.children.filter(c => c.checked).length, 0);
            const notCheckedItems = totalItems - checkedItems;
            const progressPercentage = totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;

            const handleNativeFullScreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                    });
                } else {
                    document.exitFullscreen();
                }
            };

            const thaiDate = useMemo(() => {
                if (!meetingInfo.date) return "-";
                const date = new Date(meetingInfo.date);
                return date.toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            }, [meetingInfo.date]);

            const timeRange = useMemo(() => {
                return `${meetingInfo.startTime || "..."} - ${meetingInfo.endTime || "..."} น.`;
            }, [meetingInfo.startTime, meetingInfo.endTime]);

            const gridStyle = useMemo(() => {
                const count = groups.length;
                if (count === 0) return {};
                
                let cols = 1;
                if (count === 2) cols = 2;
                else if (count <= 3) cols = 3; 
                else if (count <= 4) cols = 4;
                else if (count <= 6) cols = 3; 
                else if (count <= 8) cols = 4;
                else if (count <= 10) cols = 5;
                else if (count <= 12) cols = 6;
                else if (count <= 15) cols = 5;
                else if (count <= 18) cols = 6;
                else cols = 6; 

                return {
                    display: 'grid',
                    gridTemplateColumns: `repeat(${cols}, minmax(0, 1fr))`,
                    gap: '1rem',
                    width: '100%',
                    height: '100%',
                    alignItems: 'start', 
                    gridAutoRows: 'auto'
                };
            }, [groups.length]);

            return (
                <div className="w-full h-full flex flex-col font-sans relative overflow-hidden bg-slate-50 selection:bg-pea-gold selection:text-white">
                    {/* Animated Background */}
                    <div className="absolute inset-0 z-0">
                        <div className="absolute inset-0 bg-[#F8FAFC]">
                            <div className="absolute top-[-20%] left-[-20%] w-[80vw] h-[80vw] bg-purple-200/40 rounded-full mix-blend-multiply filter blur-[128px] animate-float"></div>
                            <div className="absolute bottom-[-20%] right-[-20%] w-[80vw] h-[80vw] bg-yellow-100/50 rounded-full mix-blend-multiply filter blur-[128px] animate-float-delayed"></div>
                            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-[0.03]"></div>
                        </div>
                    </div>

                    {/* Header Section */}
                    <header className="relative z-10 shrink-0 px-8 pt-6 pb-2">
                        <div className="bg-white/60 backdrop-blur-xl rounded-[2rem] p-6 shadow-[0_8px_40px_rgba(0,0,0,0.04)] border border-white/60 flex items-center gap-8 relative overflow-hidden group">
                            {/* Glass Shine */}
                            <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/40 to-transparent -translate-x-full group-hover:animate-[shimmer_1.5s_infinite]"></div>
                            
                            {/* Decor lines */}
                            <div className="absolute top-0 left-0 w-1.5 h-full bg-gradient-to-b from-pea-purple to-pea-dark rounded-l-2xl"></div>

                            {/* Logo */}
                            <div className="w-24 h-24 bg-gradient-to-br from-pea-purple to-pea-dark rounded-2xl flex items-center justify-center text-white shadow-xl shadow-purple-500/20 relative overflow-hidden shrink-0 group-hover:scale-105 transition-transform duration-500">
                                <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                                <div className="flex flex-col items-center relative z-10">
                                    <h1 className="font-kanit font-black text-4xl tracking-tighter leading-none">PEA</h1>
                                    <div className="w-full h-1 bg-pea-gold my-1 rounded-full shadow-[0_0_15px_rgba(253,185,19,0.8)]"></div>
                                    <span className="font-kanit font-bold text-lg tracking-widest text-purple-100">C3</span>
                                </div>
                            </div>
                            
                            {/* Title & Meta Info Area (Combined) */}
                            <div className="flex flex-col justify-center gap-3 flex-1 min-w-0">
                                <div className="w-full">
                                    <FitText text={meetingInfo.title} className="text-5xl font-black text-slate-800 tracking-tight drop-shadow-sm" />
                                </div>
                                <div className="flex items-center gap-3 text-slate-500 font-medium text-lg">
                                    <span className="bg-gradient-to-r from-pea-purple to-pea-dark text-white px-3 py-0.5 rounded-lg text-xs font-bold tracking-wide uppercase shadow-sm">EVENT</span>
                                    <span className="truncate max-w-md border-l-2 border-slate-200 pl-3">{meetingInfo.subtitle || "รายละเอียดการประชุม"}</span>
                                </div>

                                {/* Meta Info Pills - Moved Here & Adjusted */}
                                <div className="flex flex-wrap gap-3 mt-1">
                                    <div className="bg-white/80 px-4 py-1.5 rounded-full border border-slate-100 flex items-center gap-2 text-slate-600 shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5">
                                        <div className="w-6 h-6 rounded-full bg-purple-50 flex items-center justify-center text-pea-purple shrink-0">
                                            <Calendar size={14} />
                                        </div>
                                        <span className="font-kanit font-medium whitespace-nowrap text-sm">{thaiDate}</span>
                                    </div>
                                    <div className="bg-white/80 px-4 py-1.5 rounded-full border border-slate-100 flex items-center gap-2 text-slate-600 shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5">
                                        <div className="w-6 h-6 rounded-full bg-yellow-50 flex items-center justify-center text-pea-gold shrink-0">
                                            <Clock size={14} />
                                        </div>
                                        <span className="font-kanit font-medium whitespace-nowrap text-sm">{timeRange}</span>
                                    </div>
                                    <div className="bg-white/80 px-4 py-1.5 rounded-full border border-slate-100 flex items-center gap-2 text-slate-600 shadow-sm hover:shadow-md transition-all hover:-translate-y-0.5 max-w-[450px]">
                                        <div className="w-6 h-6 rounded-full bg-red-50 flex items-center justify-center text-red-400 shrink-0">
                                            <MapPin size={14} />
                                        </div>
                                        <span className="font-kanit font-medium truncate text-sm">{meetingInfo.location || "ระบุสถานที่"}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <div className="flex-1 relative z-10 p-8 pt-4 flex gap-6 min-h-0">
                        <div className="flex-1 flex flex-col gap-6 min-h-0">
                            {/* Dashboard HUD */}
                            <div className="bg-white/60 backdrop-blur-xl rounded-[2rem] p-1 shadow-lg shadow-purple-500/5 border border-white/50 flex items-center relative overflow-hidden">
                                <div className="absolute inset-0 bg-gradient-to-r from-white/0 via-white/40 to-white/0 translate-x-[-100%] animate-[shimmer_3s_infinite]"></div>
                                
                                <div className="flex-1 px-8 py-3 relative z-10">
                                    <div className="flex justify-between items-end mb-3">
                                        <div className="flex flex-col">
                                            <span className="text-[10px] font-black text-pea-purple/60 uppercase tracking-[0.2em] mb-1">Total Progress</span>
                                            <div className="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pea-purple via-pea-dark to-pea-purple">{progressPercentage}%</div>
                                        </div>
                                        {/* Removed ticks per user request */}
                                    </div>
                                    <div className="h-4 bg-slate-100 rounded-full overflow-hidden shadow-inner p-0.5">
                                        <div 
                                            className="h-full bg-gradient-to-r from-pea-gold via-yellow-400 to-pea-gold rounded-full relative transition-all duration-1000 ease-out shadow-[0_0_10px_rgba(253,185,19,0.4)] bg-[length:200%_100%] animate-wave"
                                            style={{ width: `${progressPercentage}%` }}
                                        >
                                            <div className="absolute right-0 top-0 bottom-0 w-2 bg-white/50 blur-[2px]"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="h-20 w-px bg-gradient-to-b from-transparent via-slate-200 to-transparent mx-4"></div>
                                
                                <div className="px-8 flex gap-12 relative z-10">
                                     <div className="text-center group cursor-default">
                                        <div className="relative">
                                            <div className="text-4xl font-black text-emerald-600 leading-none group-hover:scale-110 transition-transform duration-300 drop-shadow-sm">{checkedItems}</div>
                                            <div className="absolute -top-4 -right-4 w-8 h-8 bg-emerald-100 rounded-full -z-10 blur-xl group-hover:bg-emerald-200 transition-colors"></div>
                                        </div>
                                        <div className="text-[10px] text-slate-400 font-bold uppercase mt-2 tracking-widest group-hover:text-emerald-600 transition-colors">Checked In</div>
                                     </div>
                                     <div className="text-center group cursor-default">
                                        <div className="relative">
                                            <div className="text-4xl font-black text-slate-400 leading-none group-hover:scale-110 transition-transform duration-300 group-hover:text-slate-600">{notCheckedItems}</div>
                                        </div>
                                        <div className="text-[10px] text-slate-400 font-bold uppercase mt-2 tracking-widest">Pending</div>
                                     </div>
                                </div>
                            </div>

                            <div className="flex-1 min-h-0 bg-white/40 backdrop-blur-md rounded-[2.5rem] border border-white/60 p-8 overflow-hidden relative shadow-[inset_0_0_60px_rgba(255,255,255,0.6)]">
                                 <div className="h-full overflow-y-auto no-scrollbar pr-2 pb-20">
                                    {groups.length === 0 ? (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-400/60">
                                            <div className="p-6 rounded-full bg-slate-100/50 mb-4 animate-pulse">
                                                <Database size={64} className="text-slate-300" />
                                            </div>
                                            <p className="text-2xl font-kanit font-bold text-slate-300">Ready to Import</p>
                                            <p className="text-sm font-light mt-2">กรุณานำเข้าข้อมูลจากเมนูทางด้านซ้าย</p>
                                        </div>
                                    ) : (
                                        <div style={gridStyle}>
                                            {groups.map((group) => {
                                                const groupCheckedCount = group.children.filter(c => c.checked).length;
                                                const totalChildren = group.children.length;
                                                const progress = totalChildren > 0 ? (groupCheckedCount / totalChildren) * 100 : 0;
                                                const isAllChecked = groupCheckedCount === totalChildren && totalChildren > 0;
                                                const useTwoColumns = totalChildren > 6;

                                                return (
                                                    <div key={group.id} className="min-w-0 h-auto">
                                                        <div className={`
                                                            w-full relative rounded-2xl overflow-hidden transition-all duration-500 group/card flex flex-col h-full border
                                                            ${isAllChecked 
                                                                ? 'bg-gradient-to-br from-emerald-500 to-teal-600 border-teal-400/50 shadow-[0_15px_30px_-5px_rgba(16,185,129,0.3)] text-white transform scale-[1.02]' 
                                                                : 'bg-white/70 border-white hover:border-purple-200/50 hover:bg-white/90 shadow-sm hover:shadow-xl hover:-translate-y-1 backdrop-blur-sm'}
                                                        `}>
                                                            {/* Glow Effect for Checked */}
                                                            {isAllChecked && <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_right,rgba(255,255,255,0.3),transparent_70%)]"></div>}

                                                            {!isAllChecked && (
                                                                <div className="absolute top-0 left-0 h-1 w-full bg-slate-100/50 z-10">
                                                                    <div className="h-full bg-gradient-to-r from-pea-gold to-yellow-400 transition-all duration-500 shadow-[0_0_10px_rgba(253,185,19,0.5)]" style={{ width: `${progress}%` }} />
                                                                </div>
                                                            )}

                                                            <div className={`px-5 py-4 flex items-center justify-between shrink-0 border-b relative z-10 ${isAllChecked ? 'border-white/10' : 'border-slate-100'}`}>
                                                                <div className="flex items-center gap-3 min-w-0 overflow-hidden">
                                                                    <div className={`
                                                                        w-9 h-9 rounded-xl flex items-center justify-center shrink-0 shadow-sm transition-colors duration-300
                                                                        ${isAllChecked ? 'bg-white/20 text-white backdrop-blur-md' : 'bg-purple-50 text-pea-purple'}
                                                                    `}>
                                                                        {isAllChecked ? <Check size={18} strokeWidth={4} /> : <FolderOpen size={18} strokeWidth={2.5} />}
                                                                    </div>
                                                                    <h3 className="font-kanit font-bold text-lg truncate leading-tight tracking-tight">{group.name}</h3>
                                                                </div>
                                                                <div className={`text-[10px] font-black px-3 py-1 rounded-full ${isAllChecked ? 'bg-black/20 text-white backdrop-blur-sm' : 'bg-slate-100 text-slate-500'}`}>
                                                                    {groupCheckedCount}/{totalChildren}
                                                                </div>
                                                                
                                                                {!isPresenting && (
                                                                    <button onClick={(e) => { e.stopPropagation(); removeGroup(group.id); }} className="absolute top-3 right-3 p-1.5 text-white/50 hover:text-white bg-red-500/0 hover:bg-red-500/20 rounded-lg opacity-0 group-hover/card:opacity-100 transition-all z-20">
                                                                        <Trash2 size={14} />
                                                                    </button>
                                                                )}
                                                            </div>

                                                            <div className="p-5 flex-1 relative z-10">
                                                                <div className={`grid gap-x-4 gap-y-2.5 w-full content-start ${useTwoColumns ? 'grid-cols-2' : 'grid-cols-1'}`}>
                                                                    {group.children.map((child) => (
                                                                        <div 
                                                                            key={child.id}
                                                                            onClick={() => toggleCheck(group.id, child.id)}
                                                                            className={`
                                                                                cursor-pointer px-3 py-2 rounded-xl flex items-center gap-3 transition-all duration-300 border relative group/item w-full
                                                                                ${child.checked 
                                                                                    ? (isAllChecked 
                                                                                        ? 'bg-black/10 border-transparent text-white backdrop-blur-sm' 
                                                                                        : 'bg-gradient-to-r from-pea-purple to-[#5b1da3] border-transparent text-white shadow-lg shadow-purple-200/50 scale-[1.02]')
                                                                                    : 'bg-slate-50/50 border-transparent hover:bg-white hover:border-pea-gold/30 text-slate-600 hover:shadow-sm hover:text-slate-900'}
                                                                            `}
                                                                        >
                                                                            <div className={`
                                                                                w-5 h-5 rounded-full flex items-center justify-center border-[1.5px] transition-all shrink-0
                                                                                ${child.checked 
                                                                                    ? 'bg-white border-white scale-110' 
                                                                                    : 'bg-white border-slate-300 group-hover/item:border-pea-gold group-hover/item:scale-110'}
                                                                            `}>
                                                                                {child.checked && (
                                                                                    <Check size={12} className={isAllChecked ? 'text-teal-600' : 'text-pea-purple'} strokeWidth={4} />
                                                                                )}
                                                                            </div>
                                                                            <span className="text-sm font-semibold truncate leading-tight flex-1 text-left">{child.name}</span>
                                                                            
                                                                            {!isPresenting && (
                                                                                <button onClick={(e) => { e.stopPropagation(); removeDepartment(group.id, child.id); }} className="text-slate-400 hover:text-red-500 opacity-0 group-hover/item:opacity-100 px-1 absolute right-2 transition-opacity">
                                                                                    <Trash2 size={12} />
                                                                                </button>
                                                                            )}
                                                                        </div>
                                                                    ))}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    )}
                                 </div>
                            </div>
                        </div>

                        <div className="w-[340px] shrink-0 flex flex-col gap-6">
                            <div className="flex-1 bg-white/60 backdrop-blur-xl rounded-[2.5rem] p-6 shadow-[0_20px_60px_-15px_rgba(122,47,141,0.2)] border border-white/60 flex flex-col items-center justify-center gap-6 relative overflow-hidden group hover:scale-[1.02] transition-transform duration-500">
                                {/* Decor */}
                                <div className="absolute -top-10 -right-10 w-32 h-32 bg-pea-gold/20 rounded-full blur-2xl group-hover:bg-pea-gold/30 transition-colors"></div>
                                <div className="absolute -bottom-10 -left-10 w-32 h-32 bg-pea-purple/20 rounded-full blur-2xl group-hover:bg-pea-purple/30 transition-colors"></div>
                                
                                <div className="text-center z-10 relative">
                                    <div className="inline-flex items-center gap-2 bg-gradient-to-r from-pea-purple to-pea-dark px-5 py-2 rounded-full text-white font-bold text-xs mb-4 shadow-lg shadow-purple-200">
                                        <Users size={14} /> สำหรับผู้เข้าร่วม
                                    </div>
                                    <h3 className="font-kanit font-black text-3xl text-slate-800 tracking-tight drop-shadow-sm">ลงทะเบียน</h3>
                                    <p className="text-slate-500 text-sm mt-1 font-medium">สแกนเพื่อเข้าร่วมประชุม</p>
                                </div>
                                
                                {/* Floating QR Box - Removed animate-float */}
                                <div className="relative z-10 p-3 bg-white rounded-3xl shadow-[0_15px_35px_-5px_rgba(0,0,0,0.1)] border border-white w-full shrink-0 aspect-square flex items-center justify-center overflow-hidden">
                                    {qrCodes.register ? (
                                        <img src={qrCodes.register} alt="Register QR" className="w-full h-full object-cover rounded-2xl" />
                                    ) : (
                                        <div className="text-slate-300 flex flex-col items-center gap-3 animate-pulse">
                                            <QrCode size={80} strokeWidth={1.5} />
                                            <span className="text-xs font-bold uppercase tracking-widest text-slate-300/50">Upload QR</span>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {showDocQr && (
                                <div className="flex-1 bg-white/60 backdrop-blur-xl rounded-[2.5rem] p-6 shadow-[0_20px_60px_-15px_rgba(0,137,123,0.2)] border border-white/60 flex flex-col items-center justify-center gap-6 relative overflow-hidden group hover:scale-[1.02] transition-transform duration-500 animate-fadeIn">
                                    <div className="absolute -top-10 -right-10 w-32 h-32 bg-teal-200/20 rounded-full blur-2xl"></div>
                                    <div className="absolute -bottom-10 -left-10 w-32 h-32 bg-emerald-200/20 rounded-full blur-2xl"></div>

                                    <div className="text-center z-10 relative">
                                        <div className="inline-flex items-center gap-2 bg-gradient-to-r from-teal-500 to-emerald-600 px-5 py-2 rounded-full text-white font-bold text-xs mb-4 shadow-lg shadow-teal-200">
                                            <FolderOpen size={14} /> เอกสารประกอบ
                                        </div>
                                        <h3 className="font-kanit font-black text-3xl text-slate-800 tracking-tight drop-shadow-sm">ดาวน์โหลด</h3>
                                        <p className="text-slate-500 text-sm mt-1 font-medium">สแกนเพื่อรับเอกสาร</p>
                                    </div>
                                    
                                    {/* Removed animate-float */}
                                    <div className="relative z-10 p-3 bg-white rounded-3xl shadow-[0_15px_35px_-5px_rgba(0,0,0,0.1)] border border-white w-full shrink-0 aspect-square flex items-center justify-center overflow-hidden">
                                        {qrCodes.documents ? (
                                            <img src={qrCodes.documents} alt="Doc QR" className="w-full h-full object-cover rounded-2xl" />
                                        ) : (
                                            <div className="text-slate-300 flex flex-col items-center gap-3 animate-pulse">
                                                <QrCode size={80} strokeWidth={1.5} />
                                                <span className="text-xs font-bold uppercase tracking-widest text-slate-300/50">Upload QR</span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            )}
                        </div>

                    </div>
                    
                    {isPresenting && (
                        <div className="absolute top-8 right-8 z-50 flex gap-3">
                            <button 
                                onClick={handleNativeFullScreen}
                                className="w-14 h-14 bg-pea-purple hover:bg-pea-dark rounded-full flex items-center justify-center text-white shadow-2xl hover:scale-110 transition-all active:scale-95 group border-2 border-white/20"
                                title="ขยายเต็มจอ (Native)"
                            >
                                <Maximize size={24} className="group-hover:rotate-90 transition-transform duration-300" />
                            </button>
                            <button 
                                onClick={toggleFullScreen}
                                className="h-14 px-8 bg-red-600 hover:bg-red-700 rounded-full flex items-center gap-3 text-white shadow-2xl hover:scale-105 transition-all active:scale-95 group border-2 border-white/20"
                            >
                                <X size={24} className="group-hover:rotate-180 transition-transform duration-300" />
                                <span className="font-kanit font-bold text-xl">ออก</span>
                            </button>
                        </div>
                    )}
                </div>
            )
        }

        const EditorPanel = ({
            meetingInfo,
            setMeetingInfo,
            groups,
            setGroups,
            regQrInputRef,
            docQrInputRef,
            toggleFullScreen,
            showDocQr,
            setShowDocQr
        }) => {
            const [activeTab, setActiveTab] = useState('import');
            const [newDeptName, setNewDeptName] = useState("");
            const [selectedGroupId, setSelectedGroupId] = useState("");
            const [newGroupName, setNewGroupName] = useState("");
            const [importTargetGroup, setImportTargetGroup] = useState("");
            const [importTargetChild, setImportTargetChild] = useState("");
            const [collapsedGroups, setCollapsedGroups] = useState({}); 

            const handleImport = () => {
                if (importTargetGroup === "all") {
                    setGroups(JSON.parse(JSON.stringify(MASTER_DATA)));
                } else if (importTargetGroup) {
                    const masterGroup = MASTER_DATA.find(g => g.id === importTargetGroup);
                    if (!masterGroup) return;

                    let groupToAdd;
                    if (importTargetChild) {
                        const childToAdd = masterGroup.children.find(c => c.id === importTargetChild);
                        if (childToAdd) {
                            groupToAdd = { ...masterGroup, children: [childToAdd] };
                        }
                    } else {
                        groupToAdd = masterGroup;
                    }

                    if (groupToAdd) {
                        const existingGroupIndex = groups.findIndex(g => g.id === groupToAdd.id);
                        if (existingGroupIndex >= 0) {
                            const updatedGroups = [...groups];
                            const existingGroup = updatedGroups[existingGroupIndex];
                            const newChildren = groupToAdd.children.filter(
                                newChild => !existingGroup.children.some(existingChild => existingChild.id === newChild.id)
                            );
                            if (newChildren.length > 0) {
                                updatedGroups[existingGroupIndex] = {
                                    ...existingGroup,
                                    children: [...existingGroup.children, ...JSON.parse(JSON.stringify(newChildren))]
                                };
                                setGroups(updatedGroups);
                            }
                        } else {
                            setGroups([...groups, JSON.parse(JSON.stringify(groupToAdd))]);
                        }
                    }
                }
                setImportTargetChild("");
            };

            const addGroup = (e) => {
                e.preventDefault();
                if (!newGroupName.trim()) return;
                const newId = `g${Date.now()}`;
                setGroups([...groups, { id: newId, name: newGroupName, children: [] }]);
                setNewGroupName("");
            };

            const handleDeleteGroup = (groupId) => {
                if (window.confirm("คุณแน่ใจหรือไม่ที่จะลบกลุ่มนี้?")) {
                    setGroups(prev => prev.filter(g => g.id !== groupId));
                }
            };

            const handleEditGroup = (groupId, newName) => {
                setGroups(prev => prev.map(g => g.id === groupId ? { ...g, name: newName } : g));
            };

            const handleMoveGroup = (index, direction) => {
                const newGroups = [...groups];
                if (direction === 'up' && index > 0) {
                    [newGroups[index], newGroups[index - 1]] = [newGroups[index - 1], newGroups[index]];
                } else if (direction === 'down' && index < newGroups.length - 1) {
                    [newGroups[index], newGroups[index + 1]] = [newGroups[index + 1], newGroups[index]];
                }
                setGroups(newGroups);
            };

            const handleDeleteChild = (groupId, childId) => {
                if (window.confirm("คุณแน่ใจหรือไม่ที่จะลบรายการนี้?")) {
                    setGroups(prev => prev.map(g => {
                        if (g.id !== groupId) return g;
                        return { ...g, children: g.children.filter(c => c.id !== childId) };
                    }));
                }
            };

            const handleEditChild = (groupId, childId, newName) => {
                setGroups(prev => prev.map(g => {
                    if (g.id !== groupId) return g;
                    return {
                        ...g,
                        children: g.children.map(c => c.id === childId ? { ...c, name: newName } : c)
                    };
                }));
            };

            const handleMoveChild = (groupId, childIndex, direction) => {
                setGroups(prev => prev.map(g => {
                    if (g.id !== groupId) return g;
                    const newChildren = [...g.children];
                    if (direction === 'up' && childIndex > 0) {
                        [newChildren[childIndex], newChildren[childIndex - 1]] = [newChildren[childIndex - 1], newChildren[childIndex]];
                    } else if (direction === 'down' && childIndex < newChildren.length - 1) {
                        [newChildren[childIndex], newChildren[childIndex + 1]] = [newChildren[childIndex + 1], newChildren[childIndex]];
                    }
                    return { ...g, children: newChildren };
                }));
            };

            const loadDefaultData = () => {
                if(window.confirm("คำเตือน! ข้อมูลปัจจุบันทั้งหมดจะถูกแทนที่ด้วยค่าเริ่มต้น ยืนยันการคืนค่าหรือไม่?")) {
                    setGroups(JSON.parse(JSON.stringify(MASTER_DATA)));
                }
            };

            const toggleCollapse = (groupId) => {
                setCollapsedGroups(prev => ({ ...prev, [groupId]: !prev[groupId] }));
            };

            const handleAddChildQuick = (groupId) => {
                const newId = `c${Date.now()}`;
                setGroups(prev => prev.map(g => g.id === groupId ? { ...g, children: [...g.children, { id: newId, name: "หน่วยงานใหม่ (แก้ไขได้)", checked: false }] } : g));
                setCollapsedGroups(prev => ({ ...prev, [groupId]: false }));
            };

            return (
                <div className="bg-white/90 backdrop-blur-xl border-r border-slate-200 w-full md:w-[350px] shrink-0 h-full overflow-y-auto modern-scrollbar p-5 flex flex-col gap-5 font-sans text-sm shadow-xl z-20 relative">
                    <div className="absolute top-0 left-0 w-full h-[500px] bg-white/50 blur-[100px] pointer-events-none -z-10"></div>
                    
                    <div>
                        <div className="flex items-center gap-4 mb-2">
                            <div className="relative group shrink-0">
                                <div className="absolute -inset-0.5 bg-gradient-to-r from-pea-gold to-pea-purple rounded-xl blur opacity-75 group-hover:opacity-100 transition duration-500 animate-pulse-fast"></div>
                                <div className="relative w-12 h-12 bg-white rounded-xl flex items-center justify-center border border-slate-100 shadow-lg">
                                    <Check size={28} className="text-pea-purple drop-shadow-sm" strokeWidth={3} />
                                </div>
                            </div>
                            <div>
                                <h2 className="text-2xl font-extrabold font-kanit text-slate-800 tracking-tight flex items-center gap-1">
                                    PEAC3 <span className="text-transparent bg-clip-text bg-gradient-to-r from-pea-purple to-pea-dark">Check-in</span>
                                </h2>
                                <p className="text-slate-500 text-[10px] font-medium leading-tight tracking-wide uppercase">System Control Panel</p>
                            </div>
                        </div>
                        <div className="h-px w-full bg-gradient-to-r from-pea-purple/30 via-pea-gold/30 to-transparent mt-3 mb-5"></div>
                    </div>

                    <div className="bg-white p-1.5 rounded-xl border border-slate-100 shadow-inner">
                        <div className="flex gap-1 p-1 mb-3 bg-slate-50 rounded-lg border border-slate-100">
                            <button 
                                onClick={() => setActiveTab('import')}
                                className={`flex-1 py-2 rounded-md text-xs font-bold transition-all flex items-center justify-center gap-2 relative overflow-hidden group ${activeTab === 'import' ? 'text-white shadow-md' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                {activeTab === 'import' && (
                                    <div className="absolute inset-0 bg-gradient-to-r from-pea-purple to-pea-dark opacity-100 rounded-md"></div>
                                )}
                                <span className="relative z-10 flex items-center gap-2"><Database size={14} /> นำเข้าข้อมูล</span>
                            </button>
                            <button 
                                onClick={() => setActiveTab('settings')}
                                className={`flex-1 py-2 rounded-md text-xs font-bold transition-all flex items-center justify-center gap-2 relative overflow-hidden group ${activeTab === 'settings' ? 'text-white shadow-md' : 'text-slate-500 hover:text-slate-700'}`}
                            >
                                {activeTab === 'settings' && (
                                    <div className="absolute inset-0 bg-gradient-to-r from-pea-purple to-pea-dark opacity-100 rounded-md"></div>
                                )}
                                <span className="relative z-10 flex items-center gap-2"><Settings size={14} /> ตั้งค่า</span>
                            </button>
                        </div>

                        <div className="p-1">
                            {activeTab === 'import' ? (
                                <div className="space-y-3 font-prompt animate-fadeIn">
                                    <div className="relative group">
                                        <select 
                                            value={importTargetGroup}
                                            onChange={(e) => {
                                                setImportTargetGroup(e.target.value);
                                                setImportTargetChild("");
                                            }}
                                            className="w-full p-3 pl-4 pr-10 appearance-none border border-slate-200 rounded-xl text-sm bg-slate-50 outline-none focus:ring-1 focus:ring-pea-purple focus:border-pea-purple transition-all text-slate-700 font-medium hover:border-pea-purple/50"
                                        >
                                            <option value="">-- เลือกกลุ่มข้อมูล --</option>
                                            <option value="all" className="font-bold text-pea-purple">⚡ เลือกทั้งหมด</option>
                                            {MASTER_DATA.map(g => (
                                                <option key={g.id} value={g.id}>{g.name}</option>
                                            ))}
                                        </select>
                                        <ChevronRight className="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none rotate-90" size={16} />
                                    </div>

                                    {importTargetGroup && importTargetGroup !== "all" && (
                                        <div className="relative animate-fadeIn group">
                                             <select 
                                                value={importTargetChild}
                                                onChange={(e) => setImportTargetChild(e.target.value)}
                                                className="w-full p-3 pl-4 border border-slate-200 rounded-xl text-sm bg-slate-50 outline-none focus:ring-1 focus:ring-pea-purple focus:border-pea-purple transition-all text-slate-700 hover:border-pea-purple/50"
                                            >
                                                <option value="">-- ทั้งหมดในกลุ่ม (ค่าเริ่มต้น) --</option>
                                                {MASTER_DATA.find(g => g.id === importTargetGroup)?.children.map(c => (
                                                    <option key={c.id} value={c.id}>{c.name}</option>
                                                ))}
                                            </select>
                                        </div>
                                    )}

                                    <button 
                                        onClick={handleImport}
                                        disabled={!importTargetGroup}
                                        className="w-full relative overflow-hidden bg-slate-800 disabled:bg-slate-200 disabled:text-slate-400 text-white p-3 rounded-xl transition-all flex justify-center items-center gap-2 font-bold shadow-lg group hover:scale-[1.02] active:scale-95"
                                    >
                                        {!(!importTargetGroup) && (
                                            <>
                                                <div className="absolute inset-0 bg-gradient-to-r from-pea-purple to-pea-dark opacity-100 group-hover:opacity-90 transition-opacity"></div>
                                                <div className="absolute top-0 -left-full w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent transform group-hover:translate-x-[200%] transition-transform duration-700"></div>
                                            </>
                                        )}
                                        <span className="relative z-10 flex items-center gap-2"><Plus size={18} /> ยืนยันนำเข้า</span>
                                    </button>
                                </div>
                            ) : (
                                <div className="space-y-5 font-prompt animate-fadeIn">
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-800 flex items-center gap-1.5">
                                            <div className="w-1 h-3 bg-pea-purple rounded-full"></div>
                                            สร้างกลุ่มใหม่
                                        </label>
                                        <form onSubmit={addGroup} className="flex gap-2">
                                            <input 
                                                type="text" 
                                                value={newGroupName}
                                                onChange={(e) => setNewGroupName(e.target.value)}
                                                placeholder="ระบุชื่อกลุ่ม..."
                                                className="flex-1 p-2 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-pea-purple focus:ring-1 focus:ring-pea-purple/20 text-slate-700 transition-all"
                                            />
                                            <button type="submit" className="bg-pea-purple text-white p-2 rounded-lg hover:bg-pea-dark shadow-md transition-all flex-shrink-0 w-10 flex items-center justify-center">
                                                <Plus size={20} />
                                            </button>
                                        </form>
                                    </div>
                                    
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-800 flex items-center gap-1.5 justify-between">
                                            <div className="flex items-center gap-1.5">
                                                <div className="w-1 h-3 bg-pea-gold rounded-full"></div>
                                                จัดการข้อมูล ({groups.length})
                                            </div>
                                            <span className="text-[10px] font-normal text-slate-400">ลาก/แก้ไขได้</span>
                                        </label>
                                        
                                        <div className="space-y-3 pb-4">
                                            {groups.length === 0 ? (
                                                <div className="text-center py-8 text-slate-400 text-xs italic bg-slate-50 rounded-xl border border-dashed border-slate-200 flex flex-col items-center gap-2">
                                                    <FolderOpen size={24} className="opacity-50" />
                                                    ยังไม่มีข้อมูลกลุ่ม
                                                </div>
                                            ) : (
                                                groups.map((group, index) => (
                                                    <div key={group.id} className="group-card bg-white border border-slate-200 rounded-xl shadow-sm hover:shadow-md transition-shadow duration-200 overflow-hidden">
                                                        {/* Group Header */}
                                                        <div className="flex items-center gap-2 p-2 bg-slate-50/80 border-b border-slate-100">
                                                            <button 
                                                                onClick={() => toggleCollapse(group.id)}
                                                                className="p-1.5 rounded-md hover:bg-white text-slate-400 hover:text-pea-purple transition-all"
                                                            >
                                                                <div className="transition-transform duration-200" style={{ transform: collapsedGroups[group.id] ? 'rotate(-90deg)' : 'rotate(0deg)' }}>
                                                                    <ArrowDown size={14} />
                                                                </div>
                                                            </button>
                                                            
                                                            <div className="flex-1 flex items-center gap-2 relative">
                                                                <FolderOpen size={16} className="text-pea-purple shrink-0" />
                                                                <input 
                                                                    type="text" 
                                                                    value={group.name} 
                                                                    onChange={(e) => handleEditGroup(group.id, e.target.value)}
                                                                    className="w-full bg-transparent text-sm font-bold text-slate-700 outline-none border-b border-transparent focus:border-pea-purple/50 px-1 transition-colors"
                                                                />
                                                            </div>

                                                            <div className="flex items-center gap-0.5 opacity-40 group-hover:opacity-100 transition-opacity">
                                                                <button onClick={() => handleMoveGroup(index, 'up')} disabled={index === 0} className="p-1 hover:text-pea-purple hover:bg-white rounded disabled:opacity-20"><ArrowUp size={14} /></button>
                                                                <button onClick={() => handleMoveGroup(index, 'down')} disabled={index === groups.length - 1} className="p-1 hover:text-pea-purple hover:bg-white rounded disabled:opacity-20"><ArrowDown size={14} /></button>
                                                                <div className="w-px h-3 bg-slate-300 mx-1"></div>
                                                                <button onClick={() => handleDeleteGroup(group.id)} className="p-1 hover:text-red-500 hover:bg-red-50 rounded"><Trash2 size={14} /></button>
                                                            </div>
                                                        </div>
                                                        
                                                        {/* Children List */}
                                                        {!collapsedGroups[group.id] && (
                                                            <div className="p-2 space-y-1 bg-white animate-fadeIn">
                                                                {group.children.length === 0 && (
                                                                    <div className="text-[10px] text-slate-300 text-center py-2 italic">ว่างเปล่า</div>
                                                                )}
                                                                {group.children.map((child, cIndex) => (
                                                                    <div key={child.id} className="flex items-center gap-2 p-1.5 rounded-lg hover:bg-slate-50 group/child transition-colors">
                                                                        <div className="w-1.5 h-1.5 rounded-full bg-slate-200 group-hover/child:bg-pea-gold transition-colors shrink-0 ml-1"></div>
                                                                        <input 
                                                                            type="text" 
                                                                            value={child.name}
                                                                            onChange={(e) => handleEditChild(group.id, child.id, e.target.value)}
                                                                            className="flex-1 bg-transparent text-xs text-slate-600 outline-none border-b border-transparent focus:border-pea-purple/30 focus:text-slate-900 transition-colors"
                                                                        />
                                                                        
                                                                        <div className="flex gap-0.5 opacity-0 group-hover/child:opacity-100 transition-opacity">
                                                                            <button onClick={() => handleMoveChild(group.id, cIndex, 'up')} disabled={cIndex === 0} className="p-1 hover:text-pea-purple disabled:opacity-20"><ArrowUp size={12} /></button>
                                                                            <button onClick={() => handleMoveChild(group.id, cIndex, 'down')} disabled={cIndex === group.children.length - 1} className="p-1 hover:text-pea-purple disabled:opacity-20"><ArrowDown size={12} /></button>
                                                                            <button onClick={() => handleDeleteChild(group.id, child.id)} className="p-1 hover:text-red-500"><Trash2 size={12} /></button>
                                                                        </div>
                                                                    </div>
                                                                ))}
                                                                
                                                                <button 
                                                                    onClick={() => handleAddChildQuick(group.id)}
                                                                    className="w-full mt-2 py-1.5 border border-dashed border-slate-200 rounded-lg text-[10px] text-slate-400 hover:text-pea-purple hover:border-pea-purple/30 hover:bg-purple-50 transition-all flex items-center justify-center gap-1"
                                                                >
                                                                    <Plus size={10} /> เพิ่มหน่วยงาน
                                                                </button>
                                                            </div>
                                                        )}
                                                    </div>
                                                ))
                                            )}
                                        </div>
                                    </div>

                                    <button 
                                        onClick={loadDefaultData}
                                        className="w-full bg-red-50 text-red-600 border border-red-100 hover:bg-red-100 hover:border-red-200 p-2.5 rounded-xl text-xs font-bold flex items-center justify-center gap-2 transition-all shadow-sm group mt-4"
                                    >
                                        <RefreshCw size={14} className="group-hover:rotate-180 transition-transform duration-500" /> คืนค่าเริ่มต้น (Restore Defaults)
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>

                    <div className="border-t border-slate-100 pt-5 space-y-4 font-prompt">
                        <h3 className="font-bold font-kanit text-slate-800 flex items-center gap-2 text-sm">
                            <LayoutTemplate size={16} className="text-pea-purple" />
                            รายละเอียดการประชุม
                        </h3>
                        <div className="space-y-3">
                            <div className="space-y-1">
                                <label className="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Topic</label>
                                <input 
                                    type="text" 
                                    value={meetingInfo.title}
                                    onChange={(e) => setMeetingInfo(prev => ({...prev, title: e.target.value}))}
                                    className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-pea-purple focus:bg-white transition-all text-slate-700 placeholder-slate-400"
                                    placeholder="หัวข้อการประชุม"
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Subtitle</label>
                                <input 
                                    type="text" 
                                    value={meetingInfo.subtitle}
                                    onChange={(e) => setMeetingInfo(prev => ({...prev, subtitle: e.target.value}))}
                                    className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-pea-purple focus:bg-white transition-all text-slate-700 placeholder-slate-400"
                                    placeholder="หน่วยงานเจ้าของเรื่อง"
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Date</label>
                                <input 
                                    type="date" 
                                    value={meetingInfo.date}
                                    onChange={(e) => setMeetingInfo(prev => ({...prev, date: e.target.value}))}
                                    className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-pea-purple focus:bg-white transition-all text-slate-700"
                                />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Time Range</label>
                                <div className="flex gap-2 items-center">
                                    <select
                                        value={meetingInfo.startTime}
                                        onChange={(e) => setMeetingInfo(prev => ({...prev, startTime: e.target.value}))}
                                        className="flex-1 p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-pea-purple focus:bg-white transition-all text-slate-700"
                                    >
                                        {TIME_OPTIONS.map(time => (
                                            <option key={`start-${time}`} value={time}>{time}</option>
                                        ))}
                                    </select>
                                    <span className="text-slate-400 text-xs font-light">ถึง</span>
                                    <select
                                        value={meetingInfo.endTime}
                                        onChange={(e) => setMeetingInfo(prev => ({...prev, endTime: e.target.value}))}
                                        className="flex-1 p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-pea-purple focus:bg-white transition-all text-slate-700"
                                    >
                                        {TIME_OPTIONS.map(time => (
                                            <option key={`end-${time}`} value={time}>{time}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            <div className="space-y-1">
                                <label className="text-[9px] text-slate-400 font-bold uppercase tracking-widest">Location</label>
                                <textarea 
                                    rows="2"
                                    value={meetingInfo.location}
                                    onChange={(e) => setMeetingInfo(prev => ({...prev, location: e.target.value}))}
                                    className="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm outline-none focus:border-pea-purple focus:bg-white resize-none transition-all text-slate-700 placeholder-slate-400"
                                    placeholder="สถานที่"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="border-t border-slate-100 pt-5 font-prompt">
                        <div className="flex items-center justify-between mb-3">
                            <h3 className="font-bold font-kanit text-slate-800 flex items-center gap-2 text-sm">
                                <QrCode size={16} className="text-pea-purple" /> 
                                อัปโหลด QR Code
                            </h3>
                            <label className="flex items-center gap-2 cursor-pointer select-none group">
                                <div className={`w-4 h-4 rounded border flex items-center justify-center transition-all duration-300 ${showDocQr ? 'bg-pea-purple border-pea-purple shadow-sm' : 'bg-transparent border-slate-300 group-hover:border-pea-purple'}`}>
                                    {showDocQr && <Check size={10} className="text-white" strokeWidth={4} />}
                                </div>
                                <input type="checkbox" className="hidden" checked={showDocQr} onChange={() => setShowDocQr(!showDocQr)} />
                                <span className="text-[10px] text-slate-400 font-bold group-hover:text-pea-purple transition-colors">แนบ QR เอกสาร</span>
                            </label>
                        </div>
                        
                        <div className={`grid gap-3 transition-all ${showDocQr ? 'grid-cols-2' : 'grid-cols-1'}`}>
                            <button 
                                onClick={() => regQrInputRef.current && regQrInputRef.current.click()}
                                className="p-3 border border-dashed border-pea-purple/30 bg-pea-purple/5 rounded-xl text-pea-purple text-xs hover:bg-pea-purple/10 hover:border-pea-purple/60 transition-all flex flex-col items-center gap-2 h-24 justify-center group relative overflow-hidden"
                            >
                                <div className="absolute inset-0 bg-white/50 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <div className="bg-white p-2 rounded-full shadow-sm group-hover:scale-110 transition-transform">
                                     <Upload size={18} />
                                </div>
                                <span className="relative z-10 text-center leading-tight">ลงทะเบียน</span>
                            </button>
                            
                            {showDocQr && (
                                <button 
                                    onClick={() => docQrInputRef.current && docQrInputRef.current.click()}
                                    className="p-3 border border-dashed border-slate-300 bg-slate-50 rounded-xl text-slate-500 text-xs hover:bg-slate-100 hover:border-slate-400 transition-all flex flex-col items-center gap-2 h-24 justify-center animate-fadeIn group relative overflow-hidden"
                                >
                                     <div className="bg-white p-2 rounded-full shadow-sm group-hover:scale-110 transition-transform">
                                         <Upload size={18} />
                                     </div>
                                    <span className="relative z-10">เอกสารแนบ</span>
                                </button>
                            )}
                        </div>
                    </div>

                    <div className="mt-auto pt-6 space-y-4">
                        <button
                            onClick={toggleFullScreen}
                            className="relative w-full group h-[88px] rounded-2xl overflow-hidden cursor-pointer shadow-lg shadow-purple-100 hover:shadow-xl hover:shadow-purple-200/60 transition-all hover:scale-[1.02] active:scale-95 border border-white"
                        >
                            {/* Base Background Gradient */}
                            <div className="absolute inset-0 bg-gradient-to-r from-pea-purple to-pea-dark" />
                            
                            {/* Pattern Overlay */}
                            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10"></div>
                            
                            {/* Main Content Container */}
                            <div className="absolute inset-0 flex items-center px-4 gap-4 overflow-hidden z-10">
                                
                                {/* Ambient Lights */}
                                <div className="absolute -right-8 -top-8 w-32 h-32 bg-white/10 rounded-full blur-3xl group-hover:bg-white/20 transition-colors duration-500" />
                                
                                {/* Icon Box */}
                                <div className="relative w-12 h-12 rounded-xl bg-white/20 backdrop-blur-md border border-white/30 flex items-center justify-center shrink-0 group-hover:bg-white group-hover:text-pea-purple transition-all duration-300 z-20 shadow-inner">
                                     <Maximize size={24} className="text-white group-hover:text-pea-purple transition-colors duration-300" strokeWidth={2.5} />
                                </div>

                                {/* Text Content */}
                                <div className="flex flex-col items-start min-w-0 relative z-20 flex-1">
                                    <span className="font-kanit font-bold text-lg text-white tracking-wide">
                                        เข้าสู่โหมดนำเสนอ
                                    </span>
                                    <div className="flex items-center gap-2 w-full">
                                         <span className="text-[10px] text-purple-200 font-medium tracking-[0.2em] uppercase truncate">Visualization</span>
                                         <div className="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse shadow-sm" />
                                    </div>
                                </div>
                                
                                {/* Chevron */}
                                <div className="relative z-20 text-purple-200 group-hover:text-white transition-colors duration-300 group-hover:translate-x-1">
                                    <ChevronRight size={20} />
                                </div>
                                
                                {/* Shine Sweep Animation */}
                                 <div className="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -skew-x-12 -translate-x-[200%] group-hover:translate-x-[200%] transition-transform duration-1000 ease-in-out" />
                            </div>
                        </button>

                        <div className="text-[10px] text-slate-400 font-light text-center border-t border-slate-100 pt-3">
                            ผู้ออกแบบและพัฒนาระบบ โดย นายภูวดล กล่ำทอง ผบส.กบฟ.(ก3)
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [meetingInfo, setMeetingInfo] = useState({
                title: "",
                subtitle: "",
                date: new Date().toISOString().split('T')[0],
                startTime: "09:00",
                endTime: "12:00",
                location: ""
            });

            // Initialize with empty array
            const [groups, setGroups] = useState([]);
            const [qrCodes, setQrCodes] = useState({ register: null, documents: null });
            const [isPresenting, setIsPresenting] = useState(false);
            const [showDocQr, setShowDocQr] = useState(false);
            
            const regQrInputRef = useRef(null);
            const docQrInputRef = useRef(null);

            const toggleFullScreen = () => {
                setIsPresenting(!isPresenting);
            };

            useEffect(() => {
                const handleEsc = (event) => {
                    if (event.key === "Escape") {
                        setIsPresenting(false);
                    }
                };
                window.addEventListener("keydown", handleEsc);
                return () => {
                    window.removeEventListener("keydown", handleEsc);
                };
            }, []);

            const toggleCheck = (groupId, childId) => {
                setGroups(prev => prev.map(g => g.id === groupId ? {
                    ...g, children: g.children.map(c => c.id === childId ? { ...c, checked: !c.checked } : c)
                } : g));
            };
            
            const removeDepartment = (groupId, childId) => {
                setGroups(prev => prev.map(g => g.id === groupId ? {
                    ...g, children: g.children.filter(c => c.id !== childId)
                } : g).filter(g => g.children.length > 0));
            };

            const removeGroup = (groupId) => {
                if (window.confirm('ยืนยันลบกลุ่มนี้?')) {
                    setGroups(prev => prev.filter(g => g.id !== groupId));
                }
            };

            const handleImageUpload = (e, type) => {
                const file = e.target.files[0];
                if (file) setQrCodes(prev => ({ ...prev, [type]: URL.createObjectURL(file) }));
            };

            return (
                <div className={`h-screen w-full font-sans flex overflow-hidden transition-colors duration-500 bg-[#F8FAFC]`}>
                    <input type="file" ref={regQrInputRef} onChange={(e) => handleImageUpload(e, 'register')} className="hidden" accept="image/*" />
                    <input type="file" ref={docQrInputRef} onChange={(e) => handleImageUpload(e, 'documents')} className="hidden" accept="image/*" />

                    <div className={`flex-shrink-0 h-full transition-all duration-500 ease-in-out z-50 ml-0 opacity-100 shadow-xl`}>
                        <EditorPanel 
                            meetingInfo={meetingInfo} setMeetingInfo={setMeetingInfo}
                            groups={groups} setGroups={setGroups}
                            regQrInputRef={regQrInputRef} docQrInputRef={docQrInputRef}
                            toggleFullScreen={toggleFullScreen}
                            showDocQr={showDocQr} setShowDocQr={setShowDocQr}
                        />
                    </div>

                    <div className={`flex-1 h-full min-w-0 flex items-center justify-center transition-all duration-500 p-0 overflow-hidden relative`}>
                        {/* Ambient Background Glow for Preview Area */}
                        <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[80%] h-[80%] bg-purple-100 blur-[150px] -z-10 rounded-full animate-pulse-fast"></div>

                        {/* Always use Simulated Preview on Main Screen */}
                        <PreviewContainer>
                             <PresentationView 
                                meetingInfo={meetingInfo} groups={groups}
                                toggleCheck={toggleCheck} removeDepartment={removeDepartment}
                                removeGroup={removeGroup}
                                qrCodes={qrCodes} toggleFullScreen={toggleFullScreen}
                                isPresenting={false} // Only used for styling inside, not for mode switching
                                showDocQr={showDocQr}
                            />
                        </PreviewContainer>
                    </div>

                    {/* Actual Full Screen Overlay */}
                    {isPresenting && (
                        <FullScreenOverlay>
                             <PresentationView 
                                meetingInfo={meetingInfo} groups={groups}
                                toggleCheck={toggleCheck} removeDepartment={removeDepartment}
                                removeGroup={removeGroup}
                                qrCodes={qrCodes} toggleFullScreen={toggleFullScreen}
                                isPresenting={true}
                                showDocQr={showDocQr}
                            />
                        </FullScreenOverlay>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
